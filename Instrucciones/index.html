// 1. IMPORTACIONES main.js
const { app, BrowserWindow, ipcMain } = require('electron');
const path = require('path');

// app: Controla el ciclo de vida de la aplicaci√≥n
// BrowserWindow: Crea y maneja ventanas
// ipcMain: Comunicaci√≥n entre procesos (principal <-> renderizador)
// path: Maneja rutas de archivos

// 2. VARIABLE GLOBAL
let mainWindow; // Guarda referencia a la ventana principal

// 3. FUNCI√ìN: Crear ventana principal
function createMainWindow() {
  mainWindow = new BrowserWindow({
    width: 800,
    height: 600,
    webPreferences: {
      preload: path.join(__dirname, 'preload.js'), // Archivo puente
      nodeIntegration: false, // SEGURIDAD: No usar Node en el frontend
      contextIsolation: true  // SEGURIDAD: A√≠sla contextos
    }
  });

  mainWindow.loadFile('index.html'); // Carga el HTML
  // mainWindow.webContents.openDevTools(); // Abre DevTools (opcional)
}

// 4. FUNCI√ìN: Crear ventana nueva
function createNewWindow() {
  const newWindow = new BrowserWindow({
    width: 600,
    height: 400,
    webPreferences: {
      preload: path.join(__dirname, 'preload.js'),
      nodeIntegration: false,
      contextIsolation: true
    }
  });

  newWindow.loadFile('secondary.html');
}

// 5. FUNCI√ìN: Crear ventana modal
function createModalWindow() {
  const modalWindow = new BrowserWindow({
    width: 400,
    height: 300,
    parent: mainWindow, // La ventana principal es su "pap√°"
    modal: true, // No puedes interactuar con la ventana padre hasta cerrar esta
    webPreferences: {
      preload: path.join(__dirname, 'preload.js'),
      nodeIntegration: false,
      contextIsolation: true
    }
  });

  modalWindow.loadFile('modal.html');
}

// 6. EVENTO: Cuando la app est√° lista
app.whenReady().then(() => {
  createMainWindow();

  // ESCUCHADOR: Espera se√±ales desde el frontend
  ipcMain.on('create-window', () => {
    createNewWindow();
  });

  ipcMain.on('create-modal', () => {
    createModalWindow();
  });
});

// 7. EVENTO: Cerrar todas las ventanas
app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') { // Si NO es macOS
    app.quit(); // Cierra la aplicaci√≥n
  }
});

// 8. EVENTO: Activar (solo macOS)
app.on('activate', () => {
  if (BrowserWindow.getAllWindows().length === 0) {
    createMainWindow(); // Recrea ventana si no hay ninguna
  }
});


// 1. IMPORTACIONES preload.js
const { contextBridge, ipcRenderer } = require('electron');

// contextBridge: Expone funciones de forma SEGURA al frontend
// ipcRenderer: Env√≠a mensajes al proceso principal (ipcMain)

// 2. EXPONER FUNCIONES AL FRONTEND DE FORMA SEGURA
contextBridge.exposeInMainWorld('electronAPI', {
    // La ventana principal usar√°: window.electronAPI.createWindow()
    createWindow: () => ipcRenderer.send('create-window'),
    
    // La ventana principal usar√°: window.electronAPI.createModal()
    createModal: () => ipcRenderer.send('create-modal')
});

// ¬øPor qu√© necesitamos esto?
// Sin preload.js: El frontend NO puede usar require() ni ipcRenderer
// Con preload.js: El frontend PUEDE usar SOLO las funciones que exponemos
// Es como darle al frontend un control remoto con botones espec√≠ficos


  index.html
  <!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Mi App Electron</title>
    <style>
        /* CSS: Estilos de la ventana */
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        button {
            padding: 12px 24px;
            margin: 10px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background: white;
            color: #667eea;
            font-size: 16px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <h1>üè† Ventana Principal</h1>
    <p>Esta es la ventana principal de la aplicaci√≥n</p>
    
    <!-- Botones que el usuario puede presionar -->
    <button onclick="createWindow()">‚ûï Crear Nueva Ventana</button>
    <button onclick="createModal()">üí¨ Crear Ventana Modal</button>

    <script>
        // JAVASCRIPT: C√≥digo del frontend
        // Estas funciones usan las funciones expuestas en preload.js
        
        function createWindow() {
            // Env√≠a se√±al al proceso principal para crear ventana
            window.electronAPI.createWindow();
            console.log('Solicitando crear ventana...');
        }

        function createModal() {
            // Env√≠a se√±al al proceso principal para crear modal
            window.electronAPI.createModal();
            console.log('Solicitando crear modal...');
        }
    </script>
</body>
</html>

secondary.html

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Ventana Secundaria</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 40px;
            background: #f5f5f5;
            color: #333;
        }
        .window-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="window-card">
        <h2>üìÑ Ventana Secundaria</h2>
        <p>Esta ventana es INDEPENDIENTE</p>
        <p>Puedes tener m√∫ltiples ventanas como esta</p>
        <p>Cada ventana tiene su propio HTML, CSS y JS</p>
        <button onclick="window.close()">‚ùå Cerrar</button>
    </div>
</body>
</html>

modal.html 

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Ventana Modal</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 30px;
            background: #fff3e0;
            color: #e65100;
        }
        .modal-box {
            background: white;
            border: 2px solid #ff9800;
            border-radius: 10px;
            padding: 20px;
        }
        .important {
            background: #ff9800;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="modal-box">
        <h3>‚ö†Ô∏è Ventana Modal</h3>
        <div class="important">
            <p>¬°IMPORTANTE!</p>
            <p>Esta ventana es MODAL</p>
        </div>
        <p>üîí No puedes interactuar con la ventana principal</p>
        <p>üîí Hasta que cierres esta ventana</p>
        <p>üìå Siempre est√° encima de la ventana padre</p>
        <button onclick="window.close()" style="background:#ff9800; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer;">
            ‚úÖ Entendido, cerrar
        </button>
    </div>
</body>
</html>-

package.json

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Ventana Modal</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 30px;
            background: #fff3e0;
            color: #e65100;
        }
        .modal-box {
            background: white;
            border: 2px solid #ff9800;
            border-radius: 10px;
            padding: 20px;
        }
        .important {
            background: #ff9800;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="modal-box">
        <h3>‚ö†Ô∏è Ventana Modal</h3>
        <div class="important">
            <p>¬°IMPORTANTE!</p>
            <p>Esta ventana es MODAL</p>
        </div>
        <p>üîí No puedes interactuar con la ventana principal</p>
        <p>üîí Hasta que cierres esta ventana</p>
        <p>üìå Siempre est√° encima de la ventana padre</p>
        <button onclick="window.close()" style="background:#ff9800; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer;">
            ‚úÖ Entendido, cerrar
        </button>
    </div>
</body>
</html>

1. USUARIO EJECUTA: npm start
   ‚Üì
2. ELECTRON LEE: package.json (encuentra main.js)
   ‚Üì
3. ELECTRON EJECUTA: main.js
   ‚Üì
4. MAIN.JS: app.whenReady() ‚Üí createMainWindow()
   ‚Üì
5. MAIN.JS: mainWindow.loadFile('index.html')
   ‚Üì
6. INDEX.HTML SE CARGA Y USA: preload.js
   ‚Üì
7. PRELOAD.JS EXPONE: window.electronAPI
   ‚Üì
8. USUARIO HACE CLIC: Bot√≥n "Crear Nueva Ventana"
   ‚Üì
9. INDEX.HTML: window.electronAPI.createWindow()
   ‚Üì
10. PRELOAD.JS: ipcRenderer.send('create-window')
    ‚Üì
11. MAIN.JS: ipcMain.on('create-window') ‚Üí createNewWindow()
    ‚Üì
12. MAIN.JS: newWindow.loadFile('secondary.html')
    ‚Üì
13. ¬°VENTANA SECUNDARIA CREADA!

Archivo	        Responsabilidad	              D√≥nde se ejecuta
main.js	Crea    ventanas, controla la app	    Proceso principal (Node.js)
preload.js	    Puente seguro backend   ‚Üî     frontend	Ambos procesos
index.html	    Interfaz principal	          Proceso renderizador (navegador)
secondary.html	Interfaz secundaria	          Proceso renderizador
modal.html	    Interfaz modal	              Proceso renderizador
package.json	  Configuraci√≥n del proyecto	  Sistema de archivos
